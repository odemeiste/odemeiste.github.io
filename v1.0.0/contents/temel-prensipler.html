<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3. Temel Prensipler | Ödeme İste</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.4cb6486d.css" as="style"><link rel="preload" href="/assets/js/app.e339d009.js" as="script"><link rel="preload" href="/assets/js/3.8ff0cd55.js" as="script"><link rel="preload" href="/assets/js/2.94f8a49d.js" as="script"><link rel="preload" href="/assets/js/14.5a97d4e9.js" as="script"><link rel="prefetch" href="/assets/js/10.0067c6b6.js"><link rel="prefetch" href="/assets/js/11.58fa5dff.js"><link rel="prefetch" href="/assets/js/12.140f7c86.js"><link rel="prefetch" href="/assets/js/13.592abe73.js"><link rel="prefetch" href="/assets/js/4.095f13a1.js"><link rel="prefetch" href="/assets/js/5.bd3ad437.js"><link rel="prefetch" href="/assets/js/6.f500589c.js"><link rel="prefetch" href="/assets/js/7.aa2c8a65.js"><link rel="prefetch" href="/assets/js/8.4e44d48a.js"><link rel="prefetch" href="/assets/js/9.489256c4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4cb6486d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/TCMB_logo.svg.png" alt="Ödeme İste" class="logo"> <span class="site-name can-hide">Ödeme İste</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/v1.0.0/contents/tanim-ve-kisitlamalar" class="sidebar-heading clickable open"><span>SÜRÜM 1.0.0</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/v1.0.0/contents/tanim-ve-kisitlamalar.html" class="sidebar-link">1. Tanımlar ve Kısıtlamalar</a></li><li><a href="/v1.0.0/contents/amac-ve-kapsam.html" class="sidebar-link">2. Amaç ve Kapsam</a></li><li><a href="/v1.0.0/contents/temel-prensipler.html" aria-current="page" class="active sidebar-link">3. Temel Prensipler</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-1-genel-ilkeler" class="sidebar-link">3.1 Genel İlkeler</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-2-restful-api" class="sidebar-link">3.2 RESTful API</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-3-surum-yonetimi" class="sidebar-link">3.3.	Sürüm Yönetimi</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-4-kaynak-uri-yol-yapısı" class="sidebar-link">3.4.	Kaynak URI Yol Yapısı</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-5-karakter-kodlama" class="sidebar-link">3.5.	Karakter Kodlama</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-6-veri-formatı" class="sidebar-link">3.6.	Veri Formatı</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-7-istemci-sertifika-yonetimi" class="sidebar-link">3.7.	İstemci Sertifika Yönetimi</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-8-sunucu-sertifikaları" class="sidebar-link">3.8.	Sunucu Sertifikaları</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-9-istek-cevap-mesajlarında-kullanılan-nesne-yapıları" class="sidebar-link">3.9. İstek/Cevap Mesajlarında Kullanılan Nesne Yapıları</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-10-mesaj-imzalama" class="sidebar-link">3.10. Mesaj İmzalama</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-11-durum-kodu" class="sidebar-link">3.11. Durum Kodu</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-12-gereksinimlerinin-sınıflandırılması" class="sidebar-link">3.12. Gereksinimlerinin Sınıflandırılması</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-13-istek-baslıgı" class="sidebar-link">3.13. İstek Başlığı</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-14-yanıt-baslıgı" class="sidebar-link">3.14. Yanıt Başlığı</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-15-idempotency-kuralları" class="sidebar-link">3.15. Idempotency Kuralları</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-16-http-durum-kodları" class="sidebar-link">3.16. HTTP Durum Kodları</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-17-ohs-api" class="sidebar-link">3.17. OHS API</a></li><li class="sidebar-sub-header"><a href="/v1.0.0/contents/temel-prensipler.html#_3-18-sıralı-veri-turleri" class="sidebar-link">3.18. Sıralı Veri Türleri</a></li></ul></li><li><a href="/v1.0.0/contents/odeme-iste-sistemi-ve-kavramlar.html" class="sidebar-link">4. Ödeme İste Sistemi ve Kavramlar</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-temel-prensipler"><a href="#_3-temel-prensipler" class="header-anchor">#</a> 3. Temel Prensipler </h1> <p>Bu bölümde Ödeme İste Servisleri için tanımlanan temel prensipler açıklanmaktadır.</p> <h2 id="_3-1-genel-ilkeler"><a href="#_3-1-genel-ilkeler" class="header-anchor">#</a> 3.1 Genel İlkeler</h2> <ul><li>Ödeme İste Sistemi, BKM tarafından işletilecektir.</li> <li>7x24 esasına göre çalışacaktır.</li> <li>FAST Sistemi katılımcıları katılabilir. Ancak, FAST Sistemine katılımları TCMB nezdinde onaylanmış katılımcı adayları da Ödeme İste Sistemine katılım sağlamak üzere hazırlıklara başlayabilir.</li> <li>Öİ sonrası gerçekleşen ödeme işlemleri gerçekleştiği ödeme sisteminin kurallarına tabidir.</li> <li>Bir ÖHS hem Alacaklı hem de Borçlu katılımcı olarak hizmet vermek zorundadır.</li> <li>Alacaklı ÖHS’lerin, Bölüm 4.2‘de yer alan kullanım modellerinden asgari “Sonra Kabul Hemen Öde” modelini Alacaklı’ya sunması zorunlu iken mümkünken, Borçlu ÖHS için tüm modelleri desteklemesi zorunludur.</li> <li>Sistemdeki Öİ işlemleri arşivlenecektir.</li> <li>Öİ akışları, Havale veya FAST Sistemi ödemeleri için kullanılabilecektir.</li> <li>Öİ ile gerçekleştirilecek işyeri ödemeleri, FAST İşyeri Ödemeleri kapsamında değerlendirilecek olup, üye işyeri ve takas komisyonu ile ilgili kurallar uygulanacaktır.</li> <li>Alacaklı ve Borçlu’nun aynı ÖHS nezdindeki hesapları arasındaki (İng. “onus”) Öİ ve akabindeki ödeme (Havale) akışları farklılaşabilecek olsa da (örneğin; Ödeme İste ve FAST Sistemi mesaj yapıları yerine banka içi mesaj yapıları kullanılacaktır) bu belge kapsamındaki kurallar (doğrulama kuralları, kullanım modelleri, hizmet seviyeleri vb.) gözetilerek uygulanmalıdır.</li> <li>Öİ’nin başlatılabilmesi için gereken Borçlu bilgileri, Borçlu tarafından hesap bilgisi (Ad Soyad, IBAN) olarak paylaşılabileceği gibi TR Karekod veya Kolay Adres şeklinde de paylaşılabilir.</li> <li>Öİ akışlarında kullanılan ilgili bilgilerin Borçlu ÖHS tarafından ödeme işleminin gerçekleştirileceği ödeme sistemine taşınması gerekmektedir.</li> <li>Katılımcılar, Müşterilerinden gelen ve Müşterilerine gitmesi gereken talep ve sonuçlara ilişkin anlık olarak bildirim yapmalıdır.</li> <li>Müşterilerin Borçlu olarak Öİ almama hakları bulunmakta olup, bu yönde tercihi bulunan Müşterilere Öİ sunulmaz. (Söz konusu tercihin güncellenebileceği araç/arayüzler müşterilere sunulmalıdır)</li> <li>Ödeme İste katman servisinin müşterilere sunulması için mobil kanalın kullanılması zorunlu olup diğer kanalların kullanımı ödeme hizmeti sağlayıcılarının tercihine bırakılmıştır. Mobil kanalda hizmet vermeyen katılımcıların web kanalında Ödeme İste katman servisini müşterilerine sunması gerekmektedir.</li> <li>Müşterilerin Öİ’ye karşılık verdikleri yanıtın içeriği, onların yasal yükümlülüklerini değiştirmez. Örneğin, fatura ödemesine ilişkin bir Öİ talebi alan Borçlu’nun olumsuz yanıt vermesi, onun faturayı ödeme yükümlülüğünü ortadan kaldırmaz.</li> <li>TR Karekod ile başlatılan ödeme iste akışlarının, FAST TR Karekod Teknik İlke ve Kurallar Rehberi’nde belirlenen zorunlu üretime geçiş tarihleri gözetilerek desteklenmesi gerekmektedir.</li> <li>Garantili Ödeme İste: Öİ mesajında yer alan Ödeme Garantisi Göstergesi (“OdemeGarantisiGostergesi”) alanının Alacaklı ÖHS tarafından kullanılması ve Borçlu ÖHS’nin bu talebe olumlu yanıt vermesi durumunda Borçlu ÖHS ile Alacaklı ÖHS arasında borç-alacak ilişkisi doğuran bir iş modeli kullanılabilir. Ödeme Garantisi Göstergesi bilgi olarak yer almakta olup, kullanımı katılımcılar arası ikili anlaşmalar gerektirmektedir. Bu anlaşmaların çerçevesi, Ödeme İste Sistemi kuralları kapsamında değildir.</li> <li>Müşteri halihazırda çevrim içi (mobil bankacılık, internet bankacılığı vb.) erişebilir durumda ise, ÖHS'nin varsa Ödeme İste kanal veya yetki tanımını varsayılan değeri AÇIK/KAPALI olacak şekilde sunması gerekmektedir.</li></ul> <h2 id="_3-2-restful-api"><a href="#_3-2-restful-api" class="header-anchor">#</a> 3.2 RESTful API</h2> <p>API’ler, dünya ölçeğinde yaygın bir şekilde kullanılan Temsili Durum Transferi (Representational State Transfer, REST) mimari tarzı ve JavaScript Nesne Notasyonu (JavaScript Object Notation, JSON) veri formatlarına uygun olarak geliştirilir. En üst seviye Veri Tanımlama Dili (Data Description Language) ve en iyi uygulama örnekleri için <a href="http://json-schema.org/" target="_blank" rel="noopener noreferrer">^JSON Şeması<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> temel alınır.</p> <p>İstek ve yanıt mesajlarında, isteğe bağlı veya koşullu bir alan, değer içermiyorsa, bu alan JSON payloadunda yer almamalıdır.</p> <p>Örnek kod bloğu.</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;alacakliBilgi&quot;:{
         &quot;musteriTipi&quot;:&quot;B&quot;,
         &quot;ohsKod&quot;:&quot;8000&quot;,
         &quot;kimlik&quot;:  {
             &quot;kimlikTipi&quot;: &quot;K&quot;,
             &quot;kimlikDegeri&quot;: &quot;12345678900&quot;
        },
        &quot;hesap&quot;:    {
            &quot;hesapNo&quot;: &quot;TR800800G2BGNZ90MXSE96SW2&quot;,
            &quot;hesapSahibi&quot;: &quot;AHMET YILMAZ&quot;
      }
      },
</code></pre></div><h2 id="_3-3-surum-yonetimi"><a href="#_3-3-surum-yonetimi" class="header-anchor">#</a> 3.3.	Sürüm Yönetimi</h2> <p>API sonraki aşamalarda doğabilecek gereksinimleri ve daha karmaşık kullanım durumlarını karşılamak için sürümler halinde geliştirilir ve bu durum tasarım sırasında göz önünde bulundurulur.</p> <p>Öİ API İlke ve Kuralları v1.0 sürümünde ;</p> <ul><li>İlk fazda Sonra Kabul Hemen Öde modeli olacaktır.</li></ul> <h2 id="_3-4-kaynak-uri-yol-yapısı"><a href="#_3-4-kaynak-uri-yol-yapısı" class="header-anchor">#</a> 3.4.	Kaynak URI Yol Yapısı</h2> <p>ÖHS’lerin başlattığı çağrılarda URI yolu aşağıdaki yapıyı takip eder:</p> <p><strong>[öhs-yol-ön-eki]/oi-api/[kaynak-grubu]/[sürüm]/ [kaynak]/[kaynak-no]</strong></p> <p><strong>[öhs-yol-ön-eki]/oi-api/ois/s1.0/odeme-iste/odemeIsteNo</strong></p> <p>Bu, aşağıdaki unsurlardan oluşur:</p> <ul><li>[öhs-yol-ön-eki]
İsteğe bağlı, ÖHS'ye özgü yol ön ekini ifade eder.
GEÇİT üzerinden yapılan çağrılarda BKM tarafından belirlenen sistem adı ve yol ön eki kullanılır.</li> <li>ois, ois-api
Sabit metin “ois” (Ödeme İste Servisleri kısaltması)</li> <li>[kaynak-grubu]
Kaynak grubu, API’ye erişmek için kullanılan ödeme hizmetine (HBH, ÖBH) göre erişim adresi (end point) grubunu tanımlar (“hbh” veya “obh”).</li> <li>[sürüm]
API sürümünü ifade eder (“/s[ana-sürüm].[alt-sürüm]/”).</li> <li>[kaynak]/[kaynak-no]
Kaynak detaylarını ifade eder.</li></ul> <p>ÖHS, tüm kaynakları için aynı katılımcı yolu ön ekini ve sistem adını kullanmalıdır. BKM API’lerine erişmek isteyen uygulamaların yetkilerine göre aşağıdaki API’ye abone olmaları gerekmektedir.
OIS (Ödeme İste Servisleri) :</p> <ul><li>https://xbank.com.tr/api-portal/oi-api/ois/s1.0/odeme-iste (ÖHS)</li> <li>https://gecit.api-preprod.bkm.com.tr/oi-api/ois/s1.0/odeme-iste (BKM GEÇİT)</li></ul> <h2 id="_3-5-karakter-kodlama"><a href="#_3-5-karakter-kodlama" class="header-anchor">#</a> 3.5.	Karakter Kodlama</h2> <p>API istekleri ve yanıtlarının <strong>Başlık</strong> parametrelerinde ISO-8859-1 standartında yer alan karakter kümesi kullanılmalıdır.</p> <p>API istekleri ve yanıtlarında <strong>Gövde</strong> parametrelerinde UTF-8 karakter kodlaması kullanılır. Bu, JSON için varsayılan karakter kodlamasıdır.</p> <p>Ancak, bir ÖHS'nin kendi uygulamaları ve ödeme başlattığı ödeme sistemi (Havale vb.) bazı UTF-8 karakterlerini kabul etmeyebilir. ÖHS, UTF-8 kodlaması içeren bir mesajı işleyemez ve reddederse, HTTP 400 (Hatalı İstek) durum kodu ile yanıt vermelidir.</p> <h2 id="_3-6-veri-formatı"><a href="#_3-6-veri-formatı" class="header-anchor">#</a> 3.6.	Veri Formatı</h2> <ul><li>Ödeme İste kapsamındaki zaman damgası, ISO 8601 standartına uygun olarak yerel saat bilgisini ve timezone bilgisini de içerecek şekilde &quot; yyyy-MM-dd’T’HH:mm:ssXXX &quot; formattaki haliyle hazırlanmalıdır.</li></ul> <p>Örnek:  &quot;timestamp&quot;: &quot;2021-05-30T20:34:15+03:00&quot;<br>
yyyy : 4 hane yıl<br>
MM : Başa ‘0’ eklenmiş, toplam 2 hane ay<br>
dd    : Başa ‘0’ eklenmiş, toplam 2 hane gün<br>
HH    : Başa ‘0’ eklenmiş, toplam 2 hane saat (0-23 arası değer alabilir.)<br>
mm : Başa ‘0’ eklenmiş, toplam 2 hane dakika<br>
ss    : Başa ‘0’ eklenmiş, toplam 2 hane saniye<br>
XXX : ISO 8601 Time zone</p> <ul><li>Zaman damgası hesaplamalarında, yeni günün başlangıç saatinin 00:00:00 olduğu kabul edilmiştir.</li> <li>JWT veri paketlerinde kullanılan zaman damgaları, 1 Ocak 1970 Saat 00:00:00 (UTC) anından itibaren geçen saniye sayısı değerini (Unix Time) kullanmalıdır.</li> <li>Bir ÖHS, tarihi yanlış biçimlendirilmiş bir istek aldığında, 400 (Hatalı İstek) durum kodu ve ilgili hata kodu ile yanıt vermelidir.</li> <li>ISO 4217 Standartında para birimleri ve kaç basamak ondalık değer içerebilecekleri belirlenmiştir.
<a href="https://www.iso.org/iso-4217-currency-codes.html" target="_blank" rel="noopener noreferrer">https://www.iso.org/iso-4217-currency-codes.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> adresinden ücretsiz olarak listeye erişilebilir.
API Standartlarında da para birimleri ISO 4217’de tanımlanmış olan 3 harfli kodlarla iletilir.
Örneğin; Ödeme İste API'sindeki &quot;Tutar&quot; alanı &quot;100.25&quot; ve &quot;Para Birimi&quot; alanı &quot;TRY&quot; olarak iletildiğinde 25 değerinin kuruş olduğu anlaşılmalıdır.</li> <li>Sıralı veri tipleri büyük küçük harfe duyarlı olmalıdır.</li></ul> <h2 id="_3-7-istemci-sertifika-yonetimi"><a href="#_3-7-istemci-sertifika-yonetimi" class="header-anchor">#</a> 3.7.	İstemci Sertifika Yönetimi</h2> <p>Öİ kapsamında ÖHS’lerin güvenli bir şekilde tanımlanması amacıyla elektronik sertifikalar kullanılır.</p> <p>Öİ kapsamında tarafların güvenli bir şekilde tanımlaması, uçtan uca güvenli iletişim, mesaj şifreleme ve mesaj imzalama işlevleri 15/1/2004 tarihli ve 5070 sayılı Elektronik İmza Kanunu’nda açıklanan elektronik sertifikalar kullanılarak sağlanır. Elektronik sertifikada Türkiye Cumhuriyet Merkez Bankası tarafından verilen kuruluş kodu ve kuruluşun türüne dair bilgiler bulunur.</p> <p>Tüm katılımcıların GEÇİT'e erişebilmesi için, BKM tarafından yapılan istemci sertifika doğrulamasından geçmesi gerekmektedir. İstemci sertifikası üretilmeden önce katılımcıların CSR üretme akışını tamamlaması gerekmektedir.</p> <p><strong>OpenSSL ile CSR (Certificate Signing Request) Oluşturma</strong></p> <p>Aşağıdaki komut ile 2048-bit RSA private key ve CSR oluşturulur.
openssl req -new -newkey rsa:2048 -nodes -keyout PRIVATEKEY.key -out CSR.csr
CSR ile ilgili detay bilgilerin girişinde;
Common Name (CN) olarak 4 karakterli ÖHS Kod(üye kodu) diğer alanlar için de kurum bilgileriniz ile giriş yapılır.</p> <p>Tüm bilgilerin girilmesinden sonra oluşan private key dosyası kurumunuzda saklanır. CSR dosyası ise istemci sertifika üretmek üzere kullanılır. Bu aşamada takip edilmesi gereken adımlar şu şekildedir:</p> <p>Katılımcıların, TRIP ortamı üzerinden, BKM Tarafından yetki verilmiş kullanıcılarının görebileceği &quot;İstemci Sertifika Talebi&quot; menü adımına giriş yapmaları beklenir. Açılan ekranda,&quot;CSR Dosyası Yükleme&quot; alanı içerisine, katılımcının üretmiş olduğu csr dosyası yüklenir. Yaklaşık 1 dakika içerisinde kuruma özel olarak üretilmiş olan client sertifikası indirilmeye hazır hale gelecektir. &quot;İndir&quot; butonu ile client sertifika indirilir. İstemci tarafında web isteğinin ilgili sertifika ile ilişkilendirilerek oluşturulması gerekmektedir. İstemci sertifikaları hem test hem de üretim ortamı için ayrı ayrı oluşturulup kullanılacaktır.</p> <h2 id="_3-8-sunucu-sertifikaları"><a href="#_3-8-sunucu-sertifikaları" class="header-anchor">#</a> 3.8.	Sunucu Sertifikaları</h2> <p>Sunucu sertifikalarının endpoint bilgisini (Fqdn) içerecek ve global bir Certification Authority tarafından imzalanmış olarak sunulması gerekmektedir. Örneğin; entegrasyon formu içerinde yer alan URL bilgisinin (test.xbank.com.tr) sertifika içerisinde tanımlı olması ve bu sertifikanın global bir CA örneğin Verisign tarafından imzalanmış olarak sunulması gerekmektedir.
ÖHS'ler tarafından sunucu sertifikaları uygulanmalıdır.</p> <h2 id="_3-9-istek-cevap-mesajlarında-kullanılan-nesne-yapıları"><a href="#_3-9-istek-cevap-mesajlarında-kullanılan-nesne-yapıları" class="header-anchor">#</a> 3.9. İstek/Cevap Mesajlarında Kullanılan Nesne Yapıları</h2> <p>İstek ve Cevap mesajlarında kullanılacak olan nesneler tüm elemanlarını kapsayacak şekilde TRİP uygulaması üzerinden swagger dokümanları ilerleyen zamanlarda yayınlanacaktır.</p> <h2 id="_3-10-mesaj-imzalama"><a href="#_3-10-mesaj-imzalama" class="header-anchor">#</a> 3.10. Mesaj İmzalama</h2> <p>Dijital imzalama yapısı, ÖHVPS API’de gerçekleştirilen işlemlerin ve taşınan verilerin bütünlük ve inkâr edilemezliğini sağlamak amacıyla kurgulanmıştır. İmzaların kaynak bazında hangi istek ve yanıtlara uygulandığı belirlidir.</p> <p>API yalnızca TLS'ye dayanırsa, dijital kayıtları ve inkâr edilemezlik kanıtlarını tutmak zor olur. Bu nedenle, TLS'ye dayanmayan bir inkâr edilemezlik çözümü olarak API isteğinin HTTP başlığında bir JWS kullanılarak sağlanabilir.</p> <p>HTTP isteğinin gövdesinin hash fonksiyonu (SHA256) ile özeti alınacaktır. Elde edilen özet, asimetrik anahtarları destekleyen bir algoritma kullanılarak imzalanacak ve JWS elde edilecektir.</p> <p>Bu kapsamda imzalama akışı aşağıdaki gibi olmalıdır:</p> <ul><li>ÖHS öncelikle özel ve açık anahtarlarını oluşturmalıdır. Bu anahtarları oluşturmak için aşağıda “openssl” kullanılarak oluşturma örneği paylaşılmıştır. Bu anahtarlardan özel olan anahtar mesajı imzalamak için kullanılacak olup, açık anahtar ise mesajı doğrulamak amacıyla mesajın alıcısı tarafından kullanılacaktır.</li></ul> <p>private_key.pem ve public_key.pem dosyasinin içerikleri kod tarafında kullanılacaktır.
--private.pem =&gt; Özel anahtarın ismi openssl genrsa -out private.pem 2048
--public_key.pem =&gt; Açık anahtarın ismi openssl rsa -in private.pem -pubout -outform PEM -out public_key.pem
--private_key.pem =&gt; Özel anahtarın PCKS8 formatına çevrilmesi (Java açısından PCKS8 formatında olma ihtiyacı nedeniyle) openssl pkcs8 -topk8 -inform PEM -in private.pem -out private_key.pem –nocrypt</p> <ul><li><p>Açık ve Özel anahtarlar oluşturulduktan sonra Açık Anahtar BKM ile paylaşılır. BKM bu açık anahtarı diğer katılımcıların ulaşabilmesi ve alabilmesi için bir Anahtar Deposu yaklaşımı ile bünyesinde tutar. İlgili anahtarı iletebilmek ve alabilmek için kullanılacak OHS API’ye erişim detayları 3.16.OHS API içerisinde detaylı olarak paylaşılmıştır. Eğer kurumun ilgili anahtar çiftinin yenilenme durumu söz konusu ise yenilemenin hemen ardından açık anahtar yeni bir imzalama yapılmadan önce mutlaka BKM ile paylaşılmalıdır.</p></li> <li><p>İmzalı mesajı açacak olan kurum mesajı imzalayan kurumun açık anahtarını her sorguda yeniden almak durumunda değildir. Belirli periyodlarda kendi ortamındaki anahtarı yenileyerek sistemi işletebilir. Ancak imzalayan kurum anahtar çifti yenilemesi yaptığında BKM ile açık anahtarını paylaşsa dahi imzalı mesajı doğrulayacak taraf eski açık anahtar ile doğrulama yapmaya çalıştığı için hata alacaktır. Bu ilk hata durumunda hızlıca BKM üzerinden yeni anahtarı alıp mesajı tekrar doğrulamayı denemelidir. Eğer yine hata alıyor ise doğrulama işlemini hata statüsüne almalıdır. Bu sebeple anahtar yenileyen kurum yeni açık anahtarını yeni bir mesaj imzalama yapmadan önce mutlaka BKM ile paylaşmalıdır.</p></li></ul> <p><strong>İmzalama Kuralları (İsteği Başlatan ÖHS)</strong></p> <p>ÖHS üzerinden başlayan akış örnek olarak paylaşılmıştır.</p> <ul><li>İsteği başlatan ÖHS, mesaj imzalama gerektiren her API isteğinin HTTP gövdesini (request body) kendi özel anahtarı ile şifreleyerek imza bilgisini oluşturur.</li> <li>Ardından bu imza verisini, göndereceği mesajın istek başlığında yer alan X-JWS-Signature alanında göndermelidir.</li> <li>X-JWS-Signature alanında gönderilecek olan bilgi aşağıdaki yöntem ile oluşturulmalıdır.
<ol><li>Bu alana yazılacak olan bilgi JWT formatında oluşturulmalıdır.</li> <li>Bir JWT, header-payload-signature alanlarından oluşmaktadır.
<ul><li><p>Header alanında JWT’yi imzalamak için kullanılacak algoritma belirtilmelidir. Standartlar kapsamında RS256 kullanılacaktır.</p></li> <li><p>Payload kısmında özel olarak oluşturulacak olan “body” claim alanına istek gövdesi (request body) verisinin SHA256 hash değeri karşılığı yazılmalıdır.</p></li> <li><p>JSON payload oluşturulurken RFC 7519 baz alınmalıdır. &quot;iss&quot; (Issuer) Claim, &quot;exp&quot; (Expiration Time) Claim, &quot;iat&quot; (Issued At) Claim, “body” Claim alanlarının gönderilmesi zorunludur.<a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4" target="_blank" rel="noopener noreferrer">^RFC7519<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>a. &quot;iss&quot; (Issuer) Claim : Kurumunuza özel bilgidir.</p> <p>b. &quot;exp&quot; (Expiration Time) Claim: Saniye cinsinden (Unix time) imzanın son geçerli olduğu tarih. Bu tarih mevcut sunucu saatinizden 60 dakika sonra olacak şekilde kullanılmalıdır.</p> <p>c. &quot;iat&quot; (Issued At) Claim : Saniye cinsinden (Unix time) imzanın oluşturulduğu tarih. Bu tarih mevcut sunucu saatinizden 5 dakika önce olacak şekilde kullanılmalıdır.</p> <p>d. “body” Claim : istek gövdesi (request body) verisinin SHA256 hash değeri karşılığı.</p></li> <li><p>Signature alanında da özel anahtar ile imzalanmış olan imza içeriği yer alacaktır.</p></li></ul></li></ol></li></ul> <p><strong>X-JWS-Signature</strong>: JWS imzasını içeren üstbilgi. Bu başlığın ne zaman belirtilmesi gerektiği hususu ilgili endpoint için belirtilmiştir.</p> <p><strong>Örnek X-JWS-Signature Payload Değeri</strong></p> <p>{
&quot;iss&quot;: &quot;https://xbank.com.tr&quot;,
&quot;exp&quot;: 1646832405,
&quot;iat&quot;: 1646746005,
&quot;body&quot;: &quot;c543072f97a761a1d891dc81acc380bc1e6f61ca6541bd93ebfdece338457922&quot;
}</p> <ul><li><p>İstek gönderilir. Sadece mesajın bütünlüğünü ve doğruluğunu teyit amacı ile istek gövdesi (request body) SHA256 hash değeri imzalanarak X-JWS-Signature alanında bu imza iletilir. İsteğin gövde (request body) kısmı açık ve şifresiz olarak gönderilmektedir.</p></li> <li><p>İsteği alan ÖHS, talebi gerçekleştirmeden önce aldığı API isteklerinin imzasını doğrulamalıdır. X-JWS-Signature alanındaki JWT aşağıdaki adımlarla doğrulanmalıdır.</p> <ol><li>Header kısmındaki algoritmanin RS256 olduğu kontrol edilir.</li> <li>Gönderen katılımcının açık anahtarı ile JWT verify (doğrulama) işlemi yapılır.</li> <li>Yukarıdaki işlemlerin doğruluğunun ardından JWT’nin payload kısmındaki “body” claim alanındaki bilginin, isteğin gövde verisinin SHA256 hash değerlerinin aynı olduğu kontrol edilir.</li> <li>Örnek checksum değeri
&quot;a64b19f95eeb1fb0a0a3e2dbbc6e3d8472c52184d4543417ddc6d156fc5c5571&quot; veya
&quot;A64B19F95EEB1FB0A0A3E2DBBC6E3D8472C52184D4543417DDC6D156FC5C5571&quot; şeklinde olabilir. İki hali de aynı değere sahiptir.     Kontrollerde buna dikkat edilmesi gerekmektedir.</li></ol></li> <li><p>Yukarıdaki işlemler ile doğruluğu teyit edilmiş olan isteğin talebi gerçekleştirir.</p></li> <li><p>Eğer istek doğrulanamıyor ise gönderen kurumun açık ve özel anahtar çifti yenilenmiş olabilir.</p></li> <li><p>BKM OHS API üzerinden ilgili kurumun bilgilerini (kurum kodu vs) kullanarak kurumun detay bilgileri çeker ve kendi ortamında yeniler.</p></li> <li><p>Ardından imzayı tekrar açık anahtar ile doğrulayarak kontroller gerçekleştirilir. (Eğer halen doğrulama işlemi başarısız ise bu istek için hata akışı çalıştırılır. <strong>TR.OIS.Resource.InvalidSignature</strong> kodu ile hata üretilebilir.)</p></li> <li><p>İmza bilgisinin beklendiği (x-jws-signature) servislerde, bu bilginin iletilmediği durumlarda <strong>TR.OIS.Resource.MissingSignature</strong> hatası üretilebilir.</p></li> <li><p>İsteği alan ÖHS ; isteği işledikten sonra cevabı oluştururken de yukarıdaki akışlar ile göndereceği cevabı imzalamalıdır.</p></li> <li><p>İstek yanıt gövdesinin SHA256 checksum değeri için hexadecimal çıktı kullanılacaktır. Oluşacak çıktının 64 karakter olması beklenmektedir. Kontrol için &quot;^[A-Fa-f0-9]{64}$&quot; RegEx tarifini kullanabilirsiniz.</p></li></ul> <p><strong>Anahtar Deposu</strong></p> <p>ÖHS'ler tarafından güvenilen bir Güven Otoritesi (Trust Anchor), taraflar için bir genel anahtar deposu sağlamaktan sorumludur.
Güven Otoritesi, taraflardan herhangi birisinin oluşturduğu bir anahtar çiftinin açık bölümünü saklayan merkezi bir dizin (BKM tarafından tutulan merkezi kayıt sistemi vb.) olacaktır.
Mesajları doğrulamak için tarafların açık anahtarlarının paylaşılması için BKM bir servis sağlayacaktır. HHS API olarak adlandırılımış olan bu servis ile ÖHS listesine ulaşılabildiği gibi doğrulama işlemi için ihtiyaç duyulacak olan açık anahtarlara da bu servis üzerinden erişilebilinecektir.</p> <h2 id="_3-11-durum-kodu"><a href="#_3-11-durum-kodu" class="header-anchor">#</a> 3.11. Durum Kodu</h2> <p>API’ler, iki farklı amaca hizmet eden iki durum kodu kullanır:</p> <ul><li>HTTP Durum Kodu, API çağrısının (kaynaktaki HTTP işlemi) sonucunu yansıtır.</li> <li>Bazı kaynak payload’larındaki Durum alanı, kaynakların durumunu yansıtır.</li></ul> <h2 id="_3-12-gereksinimlerinin-sınıflandırılması"><a href="#_3-12-gereksinimlerinin-sınıflandırılması" class="header-anchor">#</a> 3.12. Gereksinimlerinin Sınıflandırılması</h2> <p>Erişim adreslerinin ve alanların kullanımı Zorunlu(Z), İsteğe Bağlı(İ), Koşullu(K), Yok(N/A) olabilir. Kullanımlara ilişkin durumlar ve kullanımın (K) koşullu olduğu duruma ilişkin açıklamalar ilgili tablolarda belirtilmiştir.</p> <p>Öİ API'lerinin istek ve yanıtta kullanılacak başlık isimleri, ilgili RFC dokümanlarında ve aşağıdaki tabloda yer aldığı şekilde kullanılacaktır. Uygulamaya özelleşmiş başlıklar &quot;X-&quot; ile başlayacaktır. Başlık isimlerinde yer alacak kısaltmalar tamamı büyük harfle yazılacak şekilde tanımlanacaktır. Başlık isimleri büyük – küçük harfe duyarlı olmamalıdır. Örneğin x-request-id ya da X-Request-ID olarak gönderilmiş olan bir istek başlığı değişkeni, sunucu tarafında hata vermeyecek şekilde işlenebilmelidir.</p> <h2 id="_3-13-istek-baslıgı"><a href="#_3-13-istek-baslıgı" class="header-anchor">#</a> 3.13. İstek Başlığı</h2> <ul><li>&quot;Başlık isimleri&quot; yorumlanırken küçük büyük harfe duyarlı olmamalıdır. Örneğin &quot;x-ReQuEsT-Id&quot;         geçerli bir başlık ismidir.</li> <li>&quot;Başlık değerleri&quot; yorumlanırken ise küçük büyük harf duyarlılığı olmalıdır. Örneğin &quot;xyz123&quot; ile &quot;XYZ123&quot; değerleri farklıdır.</li> <li>Başlık değerlerinde ISO-8859-1 standartında yer alan karakter kümesi kullanılmalıdır. Örneğin &quot;X-Request-Id&quot; değerinde &quot;İOS12&quot; yazmak, büyük &quot;İ&quot; harfinin ISO-8859-1 içerisinde yer almamasından dolayı, hataya yol açacaktır.</li> <li>İstek ve Yanıt başlığında yer alan alanların; POST GET DELETE methodlarında, Zorunlu/Koşullu/İsteğe Bağlı/Yok kullanım durumları aşağıdaki tabloda listelenmiştir.</li></ul> <p><strong>Tablo 2: İstek Başlığında Yer Alan Veriler</strong></p> <table><thead><tr><th>Başlık İsimleri</th> <th>Format</th> <th>Notlar</th> <th>POST</th> <th>GET</th> <th>DELETE</th></tr></thead> <tbody><tr><td>X-Request-ID</td> <td>AN1..36</td> <td>İsteği başlatan ÖHS tarafından belirlenen çağrıya özgü talep kimliği. İstek numarası. <br> Örnek: Ödeme iste talebi iş akışının her adımında farklı “x-request-id” değeri kullanılır. <br> Çağrıların aynı yanıtı dönmesinin beklendiği durumlarda (idempotent işlemlerde) aynı değer ile çağrı yapılır.</td> <td>Z</td> <td>Z</td> <td>Z</td></tr> <tr><td>Content-Type</td> <td>AN1..20</td> <td>Standart HTTP Başlığı; Talepte sağlanan payload’ın biçimini temsil eder. Bu değerin application/json olarak gönderilmesi gerekmektedir.<br> (Başka bir değere ayarlanırsa, ÖHS, 415 Desteklenmeyen Ortam Türü (Unsupported Media Type) ile yanıt vermelidir)</td> <td>Z</td> <td>-</td> <td>-</td></tr> <tr><td>X-Recipient-Code</td> <td>AN4</td> <td>Alacaklı ÖHS Kod bilgisidir.</td> <td>Z</td> <td>Z</td> <td>Z</td></tr> <tr><td>X-Sender-Code</td> <td>AN4</td> <td>Borçlu ÖHS Kod bilgisidir.</td> <td>Z</td> <td>Z</td> <td>Z</td></tr> <tr><td>Authorization</td> <td>AN1..4096</td> <td>Katılımcı ile GEÇİT arasındaki otorizasyon için kullanılan token bilgisidir.</td> <td>Z</td> <td>Z</td> <td>Z</td></tr> <tr><td>X-JWS-Signature</td> <td>AN1..4096</td> <td>HTTP isteğinin gövdesinin hash fonksiyonu (SHA256) ile özeti alınacaktır. Elde edilen özet, asimetrik anahtarları destekleyen bir algoritma kullanılarak imzalanacak ve JWS elde edilecektir.Bu başlığın ne zaman belirtilmesi gerektiği hususu ilgili endpoint için imzalama türü başlığında İmzalı İstek olarak belirtilmiştir.</td> <td>Z</td> <td>Z</td> <td>Z</td></tr></tbody></table> <h2 id="_3-14-yanıt-baslıgı"><a href="#_3-14-yanıt-baslıgı" class="header-anchor">#</a> 3.14. Yanıt Başlığı</h2> <ul><li>&quot;Başlık isimleri&quot; yorumlanırken küçük büyük harfe duyarlı olmamalıdır. Örneğin &quot;x-ReQuEsT-Id&quot; geçerli bir başlık ismidir.</li> <li>&quot;Başlık değerleri&quot; yorumlanırken ise küçük büyük harf duyarlılığı olmalıdır. Örneğin &quot;xyz123&quot; ile &quot;XYZ123&quot; değerleri farklıdır.</li> <li>Başlık değerlerinde ISO-8859-1 standartında yer alan karakter kümesi kullanılmalıdır. Örneğin &quot;X-Request-Id&quot; değerinde &quot;İOS12&quot;<br>
yazmak, büyük &quot;İ&quot; harfinin ISO-8859-1 içerisinde yer almamasından dolayı, hataya yol açacaktır.</li></ul> <p><strong>Tablo 3: Yanıt Başlığında Yer Alan Veriler</strong></p> <table><thead><tr><th>Başlık İsimleri</th> <th>Format</th> <th>Notlar</th> <th>POST</th> <th>GET</th> <th>DELETE</th></tr></thead> <tbody><tr><td>X-Request-ID</td> <td>AN1..36</td> <td>İsteği başlatan ÖHS tarafından belirlenen çağrıya özgü talep kimliği. İstek numarası. <br> Örnek: Ödeme iste talebi iş akışının her adımında farklı “x-request-id” değeri kullanılır. <br> Çağrıların aynı yanıtı dönmesinin beklendiği durumlarda (idempotent işlemlerde) aynı değer ile çağrı yapılır. <br> <strong>İlgili istek başlığındaki bilgi geri dönülür.</strong></td> <td>Z</td> <td>Z</td> <td>Z</td></tr> <tr><td>Content-Type</td> <td>AN1..20</td> <td>Standart HTTP Başlığı; Talepte sağlanan payload’ın biçimini temsil eder. Bu değerin application/json olarak gönderilmesi gerekmektedir.<br> (Başka bir değere ayarlanırsa, ÖHS, 415 Desteklenmeyen Ortam Türü (Unsupported Media Type) ile yanıt vermelidir)</td> <td>Z</td> <td>-</td> <td>-</td></tr> <tr><td>X-Recipient-Code</td> <td>AN4</td> <td>Alacaklı ÖHS Kod bilgisidir. <br> <strong>İlgili istek başlığındaki bilgi geri dönülür.</strong></td> <td>Z</td> <td>Z</td> <td>Z</td></tr> <tr><td>X-Sender-Code</td> <td>AN4</td> <td>Borçlu ÖHS Kod bilgisidir. <br> <strong>İlgili istek başlığındaki bilgi geri dönülür.</strong></td> <td>Z</td> <td>Z</td> <td>Z</td></tr> <tr><td>X-JWS-Signature</td> <td>AN1..4096</td> <td>HTTP yanıtının gövdesinin hash fonksiyonu (SHA256) ile özeti alınacaktır. Elde edilen özet, asimetrik anahtarları destekleyen bir algoritma kullanılarak imzalanacak ve JWS elde edilecektir.Bu başlığın ne zaman belirtilmesi gerektiği hususu ilgili endpoint için imzalama türü başlığında İmzalı Yanıt olarak belirtilmiştir.</td> <td>Z</td> <td>Z</td> <td>Z</td></tr></tbody></table> <h2 id="_3-15-idempotency-kuralları"><a href="#_3-15-idempotency-kuralları" class="header-anchor">#</a> 3.15. Idempotency Kuralları</h2> <p>İsteği yapan ÖHS’nin aşağıdaki durumlarda aynı istek numarası (x-request-id) ve aynı veri gövdesiyle çağrıyı tekrarlaması; isteği alan ÖHS’nin de bu durumlarda aynı yanıtı dönmesi gereklidir.</p> <ul><li>İsteği alan ÖHS’nin yanıtı kesinti/arıza nedeniyle isteği yapan ÖHS’ye ulaşmaması ve zaman aşımı söz konusu olması,</li> <li>Müşteri, ÖHS uygulaması üzerinden çift tıklama ile mükerrer şekilde OI API’lerini çağırması, (API kontrollerinden önce ÖHS uygulamasının, çift tıklama kontrolü yapması önerilmektedir.)</li> <li>İsteği yapan ÖHS, yanıt almasına rağmen işleyemeden kaybetmesi,</li></ul> <p>durumlarında isteği alan ÖHS aşağıdaki kuralları işletir:</p> <ul><li>ÖHS gelen istek numarasını ve veri gövdesini birleştirerek checksum değeri üretir.
chesksum değeri x-request-id|request.body ‘nin hash algoritmalarından (CRC32,MD5 vb) geçirilerek üretilebilir.</li> <li>İsteği alan ÖHS bu checksum değeri ile isteği yapan ÖHS’ye dönmüş olduğu yanıtı 5 dk boyunca saklar. Saklama yöntemi olarak veri tabanı veya önbellek araçları kullanılabilir.</li> <li>İsteği yapan ÖHS aynı istek numarası ve aynı veri gövdesi ile yeni bir çağrı yaptığında, aynı checksum değeri üretileceği için 5dk boyunca bu değere karşılık gelen yanıtı döner.</li> <li>5 dk sonrasında istek numarası veya veri gövdesi değişmemiş olsa dahi bu isteği alan ÖHS tarafından yeni istek olarak kabul edilir.</li></ul> <p>Aşağıdaki Post işlemleri için bu kural setinin işletilmesi gerekmektedir:</p> <p>1- POST /odeme-iste</p> <h2 id="_3-16-http-durum-kodları"><a href="#_3-16-http-durum-kodları" class="header-anchor">#</a> 3.16. HTTP Durum Kodları</h2> <p>RFC 2616'da belirlenmiş olan durum kodları (status code) gönderilen isteğin durumunu  standart bir şekilde ifade eder. Eğer bir hata varsa hatayı, gönderilen istek başarılı bir şekilde işlem gördüyse ona ilişkin durumu aktarır. Durum kodları genel olarak 5 kategoridedir.</p> <ul><li>1xx Bilgi</li> <li>2xx Başarılı</li> <li>3xx Yönlendirme</li> <li>4xx İstemci Hatası</li> <li>5xx Sunucu Hatası</li></ul> <p><strong>errorCode Alanında Kullanılabilecek Sıralı Hata Tipleri :</strong></p> <blockquote><p><strong>TR.OIS.Resource</strong></p> <blockquote><p><strong>⇨	InvalidFormat</strong><br> <strong>⇨	NotFound</strong><br> <strong>⇨	InvalidSignature</strong><br> <strong>⇨	MissingSignature</strong><br> <strong>⇨	MethodNotAllowed</strong><br> <strong>⇨	NotAcceptable</strong><br> <strong>⇨	UnsupportedMediaType</strong></p></blockquote></blockquote> <blockquote><p><strong>TR.OIS.Business</strong></p> <blockquote><p><strong>⇨	InvalidContent</strong><br> <strong>⇨	InvalidAccount</strong></p></blockquote></blockquote> <blockquote><p><strong>TR.OIS.Connection</strong></p> <blockquote><p><strong>⇨	InvalidCertificate</strong><br> <strong>⇨	InvalidSender</strong><br> <strong>⇨	InvalidRecipient</strong></p></blockquote></blockquote> <blockquote><p><strong>TR.OIS.Server</strong></p> <blockquote><p><strong>⇨	InternalError</strong><br> <strong>⇨	ServiceUnavailable</strong></p></blockquote></blockquote> <p>TR.OIS.Resource.InvalidFormat hatası alındığı durumda; fieldErrors nesnesi içerisinde verilecek hata kodları :</p> <blockquote><p><strong>TR.OIS.Field</strong></p> <blockquote><p><strong>⇨	Missing</strong><br> <strong>⇨	Invalid</strong></p></blockquote></blockquote> <p><strong>Tablo 4: HTTP Durum Kodları</strong></p> <table><thead><tr><th>HTTP Durum</th> <th>İstek Sonucu ve Açıklamalar</th> <th>POST</th> <th>GET</th> <th>DELETE</th></tr></thead> <tbody><tr><td>200 OK</td> <td><strong>İstek Başarıyla Tamamlandı.</strong><br>Kaynak güncellemek için yapılan (örneğin, GET) ve başarıyla tamamlanan isteklerinde kullanılır.</td> <td>H</td> <td>E</td> <td>H</td></tr> <tr><td>201 Created</td> <td><strong>İstek Başarılı Oldu.</strong><br>Kaynak yaratma isteği (örneğin, POST /odeme-iste) başarıyla sonuçlandı.</td> <td>E</td> <td>H</td> <td>H</td></tr> <tr><td>204 No Content</td> <td><strong>Silme işlemi başarıyla tamamlandı.</strong><br>Kaynak silme isteği (örneğin, <strong>DELETE/odeme-iste/{odemeIsteNo}</strong>) başarıyla sonuçlandı.</td> <td>H</td> <td>H</td> <td>E</td></tr> <tr><td>400 Bad Request</td> <td><strong>İstekte bozuk, eksik veya uyumlu olmayan JSON gövdesi, URL parametreleri veya başlık alanları var.</strong> İstekle başlatılan işlem yapısal bozukluk, eksik veya tutarsız veri veya HHS tarafındaki kontrollerin hatalı sonuçlanması nedeniyle hata ile sonuçlanır ve hataya ilişkin veriler hata nesnesi içerisinde dönülür.</td> <td>E</td> <td>E</td> <td>E</td></tr> <tr><td>401 Unauthorized</td> <td><strong>Yetkilendirme başlığı eksik, hatalı veya geçersiz olduğundan istek yetkilendirilmediğinde ve erişim reddedildiğinde http 401 kodu dönülmelidir.</strong></td> <td>E</td> <td>E</td> <td>E</td></tr> <tr><td>404 Not Found</td> <td>**ÖHS geçerli bir API erişim adresini sağlamıyorsa, o URL'ye gelen istekler için 404 (Bulunamadı) ile yanıt vermelidir.**Uygulama esaslarında tanımlanmayan bir kaynak için bir URL'ye erişmeye çalışırsa (örneğin, GET /yurtdisi-odeme-iste), ÖHS, 404 (Bulunamadı) ile yanıt vermeyi seçebilir.</td> <td>E</td> <td>E</td> <td>E</td></tr> <tr><td>405 Method Not Allowed</td> <td><strong>İsteği başlatan ÖHS, desteklenmeyen bir yöntemle kaynağa erişmeye çalıştı.</strong></td> <td>E</td> <td>E</td> <td>E</td></tr> <tr><td>406 Not Acceptable</td> <td><strong>İstek, geçersiz bir karakter kümesi içeriyor.</strong></td> <td>E</td> <td>E</td> <td>E</td></tr> <tr><td>415 Unsupported Media Type</td> <td><strong>İstek gövdesi hedef kaynakta bu yöntem tarafından desteklenmeyen bir biçimde oluşturulduğu için işlem reddedildi</strong></td> <td>E</td> <td>H</td> <td>H</td></tr> <tr><td>500 Internal Server Error</td> <td><strong>API sunucu / servis katmanında sorun oluştu. İşlem başarısız.</strong><br> 5XX hata durumlarında yanıt gövde değeri olmadığı için mesaj imzalama yapılamaz ve x-jws-signature alanı boş olarak iletilir.<br> Bu durumda x-jws-signature kontrolü yapılmamalıdır.</td> <td>E</td> <td>E</td> <td>E</td></tr> <tr><td>503 Service Unavailable</td> <td>Hizmet sürümü kullanımdan kaldırıldı veya hizmet verilemiyor durumu.</td> <td>E</td> <td>E</td> <td>E</td></tr></tbody></table> <h2 id="_3-17-ohs-api"><a href="#_3-17-ohs-api" class="header-anchor">#</a> 3.17. OHS API</h2> <p><strong>GET /ohs/{ohsKod}</strong></p> <ul><li>https://gecit.api-preprod.bkm.com.tr/ohs-api/s1.0/ohs (BKM GEÇİT)</li> <li>https://gecit.api-preprod.bkm.com.tr/ohs-api/s1.0/ohs/1234 (BKM GEÇİT)</li></ul> <p>İşlem Sorgu Örneği = /ohs ⇨ bu sorgu yöntemi ile tüm ÖHS’lerin dizi şeklinde verileri listelenir.
İşlem Sorgu Örneği = /ohs/1234 ⇨ bu sorgu yöntemi ile gönderilmiş olan ÖHS kodu’na ait bilgiler listelenir. Ya da “404 Not Found” hatası alır.</p> <p><strong>Tablo 5: ÖHS Bilgileri Sorgulama Yanıtı “OHS” nesnesi</strong></p> <table><thead><tr><th>Alan Adı</th> <th>Parametre Adı</th> <th>Format</th> <th>Zorunlu/Koşullu/İsteğe bağlı</th> <th>Açıklama</th></tr></thead> <tbody><tr><td>ÖHS Kodu</td> <td>kod</td> <td>AN4</td> <td>Z</td> <td>ÖHS'nin kod bilgisi</td></tr> <tr><td>ÖHS Unvanı</td> <td>unv</td> <td>AN3..140</td> <td>Z</td> <td>ÖHS'nin unvan bilgisi</td></tr> <tr><td>ÖHS Markası</td> <td>marka</td> <td>AN1..140</td> <td>Z</td> <td>ÖHS'nin kod bilgisi</td></tr> <tr><td>ÖHS Kodu</td> <td>kod</td> <td>AN4</td> <td>Z</td> <td>Müşterinin kolaylıkla algılayabileceği kısa unvan bilgisi. ÖHS tarafından belirlenecektir.</td></tr> <tr><td>Açık Anahtar</td> <td>acikAnahtar</td> <td>AN1..1024</td> <td>Z</td> <td>ÖHS’nin mesaj imzalama için paylaştığı açık anahtar</td></tr> <tr><td>ÖHS Api Bilgileri</td> <td>apiBilgileri</td> <td>Kompleks: OhsApiBilgi[Array][0..N]</td> <td>Z</td> <td>Desteklenen Api ve sürüm bilgileri dönülecektir.</td></tr> <tr><td>&gt; api</td> <td>api</td> <td>AN1..20</td> <td>Z</td> <td>Api İsmi Örnek :ois</td></tr> <tr><td>&gt; surum</td> <td>surum</td> <td>AN1..10</td> <td>Z</td> <td>Api Sürüm Kodu Örnek: s1.0, s2.0 s1.0</td></tr> <tr><td>Logo Bilgileri</td> <td>logoBilgileri</td> <td>Kompleks: LogoBilgisi [Array][1..N]</td> <td>Z</td> <td>ÖHS'ye ait logo bilgileri.</td></tr> <tr><td>&gt; logoTur</td> <td>logoTur</td> <td>AN3..50</td> <td>Z</td> <td>Logonun türünü belirler. TR.OIS.DataCode.LogoTur sıralı veri türü değerlerlerinden birini alır.</td></tr> <tr><td>&gt; logoAdr</td> <td>logoAdr</td> <td>AN1..255</td> <td>Z</td> <td>ÖHS tarafında tutulan ve paylaşılacak olan url adres bilgisidir.Örnek: https://via.placeholder.com/150?text=0001</td></tr> <tr><td>&gt; logoArkaPlan</td> <td>logoArkaPlan</td> <td>AN1</td> <td>Z</td> <td>TR.OIS.DataCode.LogoArkaPlan sıralı veri türü değerlerlerinden birini alır.</td></tr> <tr><td>&gt; logoFormat</td> <td>logoFormat</td> <td>AN3</td> <td>Z</td> <td>TR.OIS.DataCode.LogoFormat sıralı veri türü değerlerlerinden birini alır.</td></tr> <tr><td>Durum</td> <td>durum</td> <td>AN1</td> <td>Z</td> <td>ÖHS'nin durum bilgisidir.TR.OIS.DataCode.OHSDurumu sıralı veri tipinde alabileceği değerler belirtilmiştir.</td></tr></tbody></table> <p>ÖHS API'de; Açık, Yaygınlaştırma, Geçici Hizmet Veremiyor, Kapalı durumlarındaki ÖHS'ler listelenecektir.</p> <p>Sertifikasyon onayı alan ÖHS'ler, üretim ortamına geçişte &quot;Yaygınlaştırma&quot; durumuna sahip olabilir. ÖHS'nin, diğer ÖHS'ler ile &quot;Yaygınlaştırma&quot; kontrollerini yapacağı, kendi yönetiminde olacaktır. Böylece Üretim Ortamında ÖHS’nin kendisi tarafından tanımlanmış kısıtlı müşteriye hizmet vermesi ve servislerini test etmesi sağlanabilir olacaktır. ÖHS’ler kendi kurum kontrollerini yapana kadar, &quot;Yaygınlaştırma&quot; durumunda kalabilirler. ÖHS'nin BKM'ye yapacağı talep ile, ÖHS &quot;Yaygınlaştırma&quot; durumundan &quot;Açık&quot; durumuna geçebilecektir.</p> <p>Aşağıdaki durumlarda ÖHS'nin statüsü Geçici Kapalı olarak güncellenebilecektir:</p> <ul><li>ÖHS'nin talebi ile uzun süreli (minimum 1 saati aşan) yaşanan teknik sorunlarda G statüsüne alınabilecektir. G statüsüne alınma talebinin ÖHS tarafından odemeiste@bkm.com.tr ye mail atarak iletilmesi beklenmektedir.</li> <li>İlgili resmi kurumlardan gelen talep üzerine ÖHS G statüsüne alınabilir.</li></ul> <p>ÖHS’ler için geçerli olacak; logo gönderiminde dikkat edilmesi gerekenler şu şekilde tariflenmiştir:</p> <ol><li>Logoların ham dosya yerine kurumun yayınlayacağı bir URL üzerinden sunulması gerekmektedir. (Örn: logoURL = https://kurumadi.com.tr/logo.png) Logo BKM tarafında host edilmeyecektir.</li> <li>Logo url’in public erişilebilir url olması gereklidir.</li> <li>Logo, yatayda veya dikeyde taşma paysız tam oturacak, sınır boyutlarını geçmeyecek ve ortalanmış yerleşime sahip olmalıdır.</li> <li>ÖHS uygulamasında gösterim esnasında logoların hızlı yüklenmesi ve düşük veri tüketmesi açısından; logo boyutu 250 KB’ın altında olmalıdır.</li> <li>ÖHS’lerin tüm logo türlerini (8 farklı tipte logoyu) zorunlu olarak dönmesi beklenmektedir.</li> <li>Circle logo kullanılması gerektiğinde ICON_LOGO logo türü kullanılmalıdır.</li> <li>Logolarını güncellemek isteyen kurumların en az 3 iş günü öncesinde BKM’ye bu değişikliği GEÇİT Test/Üretim Ortamı Entegrasyon formu ile bildirmesi gereklidir. BKM de katılımcılara ÖHS API aracılığı ile güncel logonun çekilmesi gerektiğine dair bilgilendirme yapar.</li> <li>Logoları anlık çeken katılımcıların, herhangi bir teknik nedenden dolayı güncel logoyu alamadığı durum olabilir. Bu durumda sistemlerine kaydetmiş olduğu kuruma ait ikon logoyu göstermesi gereklidir.</li> <li>ÖHS’ler API aracılığı ile almış oldukları logoların formatı üzerinde değişiklik (kare, yuvarlak hale getirip resize etmek gibi) yapabilirler. Ancak logonun görsel ve yazılarını etkileyecek bir değişiklik yapmamalıdırlar.</li> <li>ÖHS mobil uygulamasındaki dark mode ve light mode kullanımlarında, hangi logonun kullanılacağına uygulama sahibi karar verecektir.</li></ol> <h2 id="_3-18-sıralı-veri-turleri"><a href="#_3-18-sıralı-veri-turleri" class="header-anchor">#</a> 3.18. Sıralı Veri Türleri</h2> <p><strong>Tablo 6: Sıralı Veri Türleri</strong></p> <table><thead><tr><th><strong>Kod</strong></th> <th><strong>Açıklama</strong></th></tr></thead> <tbody><tr><td>TR.OIS.DataCode.MusteriTip</td> <td>B: Bireysel <br>K: Kurumsal</td></tr> <tr><td>TR.OIS.DataCode.KimlikTur</td> <td>Kod, Tip, Format <br>K , TCKN , N11 <br>V, VKN, AN10 <br>Y , YKN , N11 <br>P , PNO , AN7..9</td></tr> <tr><td>TR.OIS.DataCode.OdemeAmaci</td> <td>Ödemenin Amacına yönelik olarak aşağıdaki değerlerden birini alır:<br>01: Konut Kirası Ödemesi<br>02: İş yeri Kirası Ödemesi<br>03: Diğer Kira Ödemesi<br>04: E-Ticaret Ödemesi: Elektronik ticaret işlem amaçlı aktarımlar<br>05: Çalışan Ödemesi: Maaş, harcırah, prim gibi çalışan ödemeleri<br>06: Ticari ödeme: Ticari işletmelerin birbirlerine, kendi hesaplarına veya müşterilerine ödemeleri, borç, ithalat, ihracat, şirket satın alma, vb. kapsamında ödemeler<br>07: Bireysel Ödeme: Özel amaçlı (aile bireylerine, hediye, bağış, borç, alışveriş vs.) ödemeler<br>08: Yatırım: Mevduat, menkul kıymet, döviz, gayrı menkul, taşıt, varlık alımı, temettü ödeme, tahsilat vb. gibi yatırım amaçlı ödemeler<br>09: Finansal: Kredi, depo, repo, türev, finansal varlık alım/satımı vb. ödemeler<br>10: Eğitim ödemesi<br>11: Aidat ödemesi</td></tr> <tr><td>TR.OIS.DataCode.AkisTur</td> <td>01: Kişiden Kişiye Ödemeler</td></tr> <tr><td>TR.OIS.DataCode.OHSDurumu</td> <td>A : Açık. Üretim Ortamında ÖHS’nin aktif bir şekilde hizmet vermesi durumu.<br> Y : Yaygınlaştırma. Üretim Ortamında ÖHS’nin kendisi tarafından tanımlanmış kısıtlı müşteriye hizmet vermesi durumu. <br>  G : Geçici Hizmet Veremiyor. ÖHS servislerinde teknik bir sorun olması nedeniyle ÖHS’nin hizmet verememesi durumu. <br>K: Kapalı. ÖHS’nin hizmet vermeme durumu.</td></tr> <tr><td>TR.OIS.DataCode.OdemeIsteDurumu</td> <td>B: Yanıt Bekleniyor<br>K: Kabul Edildi<br>O: Ödeme Sistemine Emir İletildi<br> I: İptal Edildi</td></tr> <tr><td>TR.OIS.DataCode.OdemeIsteIptDtyKod</td> <td>‘01’ :Borçlu Ödeme İsteğini Reddetti<br>‘02’ :Borçlu Beklenen Sürede Ödeme İsteğine Yanıt Vermedi<br>‘03’ :Borçlu İptal Etti<br>‘04’ :Beklenen Sürede Ödeme Sistemine Emir İletilmedi<br>‘05’ :Borçlu ÖHS Fraud Nedeniyle İptal Etti<br>‘06’ :Alacaklının Ödeme İste Yetkisinin Kapalı Olması<br>‘07’ :Alacaklı Ödeme İste Talebinden B Statüsünde Vazgeçti<br>‘08’ :Alacaklı Ödeme İste Talebinden K Statüsünde Vazgeçti<br>‘09’ :Alacaklı Ödeme İste Talebinden K Statüsünde Vazgeçti<br>‘10’ : Müşteri ÖHS kontrollerini Aşamadı<br>‘99’ : Diğer<br></td></tr> <tr><td>TR.OIS.DataCode.EvetHayir</td> <td>E: Evet <br>H: Hayır</td></tr> <tr><td>TR.OIS.DataCode.LogoArkaPlan</td> <td>B : Logoların arka planının beyaz olması (Erkek Logo) <br>K : Logoların arka planının renkli/koyu olması (Dişi Logo)</td></tr> <tr><td>TR.OIS.DataCode.LogoFormat</td> <td>SVG : Logonun svg formatında olmasını ifade eder. Logonun 1:2 oranında olması gerekmektedir. <br>PNG : Logonun png formatında olmasını ifade eder. Logonun 500 X 1000 px olması gerekmektedir.</td></tr> <tr><td>TR.OIS.DataCode.LogoTur</td> <td>FULL_LOGO : Yazı ve ikon şekillerin bir arada olduğu logo <br>ICON_LOGO : İkon şekillerin olduğu ( Sadece görsel olan-yazısız ) logo</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v1.0.0/contents/amac-ve-kapsam.html" class="prev">
        2. Amaç ve Kapsam
      </a></span> <span class="next"><a href="/v1.0.0/contents/odeme-iste-sistemi-ve-kavramlar.html">
        4. Ödeme İste Sistemi ve Kavramlar
      </a>
      →
    </span></p></div> <div class="footer-wrapper"><footer class="page-edit footer"><div class="footer-info"><p style="padding-right:15px;">© Tüm hakları saklıdır.</p></div></footer></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e339d009.js" defer></script><script src="/assets/js/3.8ff0cd55.js" defer></script><script src="/assets/js/2.94f8a49d.js" defer></script><script src="/assets/js/14.5a97d4e9.js" defer></script>
  </body>
</html>
